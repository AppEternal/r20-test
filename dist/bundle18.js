!function(){"use strict";window._INTERCEPT||(window._INTERCEPT={INTERCEPTED:!1,USE_INTERCEPT:!1,intercepted:[],timeout:3e4,loopTimeout:0,timeoutReject:!0,countdownInterval:void 0}),window._INTERCEPT.handleIntercept=async t=>{try{const e=JSON.parse(t);if(e.d?.b?.d?.content&&e.d?.b?.d?.content.includes("Roll for Stats")){let t=e.d?.b?.d?.inlinerolls,n=!1;if(t&&"object"==typeof t){const e=Object.values(t).reduce(((t,e)=>(18===e.results?.total&&(n=!0),t+(e.results?.total||0))),0);if(window._INTERCEPT.loopTimeout++,$("#displayRolls").text(`Total Sum: ${e} < 90 - Timeout: ${window._INTERCEPT.loopTimeout}/500`),e>90&&n)return window._INTERCEPT.loopTimeout=0,!0;if(window._INTERCEPT.loopTimeout<500){const t=$('iframe[title*="Character sheet"]')[0];t&&t.contentWindow&&$(t.contentWindow.document).find('[name="roll_rollstats"]').trigger("click")}return!1}}}catch(t){return console.log("handleIntercept",t),!0}return!0},window._INTERCEPT.updateCountdowns=()=>{$(".countdown").each((function(){const t=$(this),e=parseInt(t.data("expire"))-Date.now();if(e<=0)t.text("Expired!");else{const n=Math.floor(e/1e3);t.text(`${n}s`)}}))},window._INTERCEPT.enable=()=>{window._INTERCEPT.USE_INTERCEPT=!0},window._INTERCEPT.disable=()=>{window._INTERCEPT.USE_INTERCEPT=!1},window._INTERCEPT.intercept=()=>{if(window._INTERCEPT.INTERCEPTED)return;window._INTERCEPT.INTERCEPTED=!0;const t=window.WebSocket.prototype.send;window.WebSocket.prototype.send=async function(e){if(!window._INTERCEPT.USE_INTERCEPT)return t.call(this,e);try{if(!await window._INTERCEPT.handleIntercept(e))return;return t.call(this,e)}catch(n){return console.log("intercept error",n),t.call(this,e)}}},window._INTERCEPT.initialize=()=>{window._INTERCEPT.intercept(),$(".r20-draggable-element").remove(),clearInterval(window._INTERCEPT.countdownInterval),window._INTERCEPT.countdownInterval=setInterval(window._INTERCEPT.updateCountdowns,1e3);let t=$("body").append('<div\r\n\tclass="ui-dialog ui-widget ui-widget-content r20-draggable-element ui-corner-all initiativedialog ui-draggable ui-resizable ui-dialog-buttons"\r\n\tstyle="position: fixed !important; top: 50%; left: 50%; z-index: 20000 !important"\r\n>\r\n\t<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle">\r\n\t\t<span id="ui-id-10" class="ui-dialog-title">Role stats like a monster</span>\r\n\t\t<a href="#" class="ui-dialog-titlebar-close ui-corner-all r20-deleteSelf" role="button">\r\n\t\t\t<span class="ui-icon ui-icon-closethick">close</span>\r\n\t\t</a>\r\n\t</div>\r\n\t<p style="max-height: 500px; overflow: auto"><span id="displayRolls"></span></p>\r\n\t<li style="display: flex; align-items: center; justify-content: space-between; padding: 4px 0">\r\n\t\t<button class="btn btn-danger" id="toggle-intercept" type="button">Disabled</button>\r\n\t\t<button class="btn btn-success acceptAll" id="reset-timeout" style="margin-right: 8px">Reset Timeout</button>\r\n\t</li>\r\n</div>\r\n'),e=$(t);e.find("#toggle-intercept").text(window._INTERCEPT.USE_INTERCEPT?"Enabled":"Disabled"),e.find("#toggle-intercept").off("click").on("click",(function(){window._INTERCEPT.USE_INTERCEPT=!window._INTERCEPT.USE_INTERCEPT,$(this).text(window._INTERCEPT.USE_INTERCEPT?"Enabled":"Disabled")})),e.find("#reset-timeout").off("click").on("click",(function(){window._INTERCEPT.loopTimeout=0,$("#displayRolls").text(`Total Sum: null - Timeout: ${window._INTERCEPT.loopTimeout}/50`)})),e.find(".r20-draggable-element").draggable({containment:"window",handle:!1,scroll:!1}),e.find(".r20-deleteSelf").on("click",(function(){window._INTERCEPT.disable(),$(this).closest(".r20-draggable-element").remove()}))},window._INTERCEPT.initialize()}();
